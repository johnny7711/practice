<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>My Map</title>
    <style media="screen">
    #target {
      width : 500px;
      height : 200px;
    }
    </style>
  </head>
  <body>
    <h1>Hello Maps</h1>
    <div id="target"></div>
    <label>住所</label>
    <input type="text" id="address"><br>
    <label>キーワード</label>
    <input type="text" id="keyword">
    <button id="search">Search</button>
    </form>
    <script src="https://maps.googleapis.com/maps/api/js?language=ja&key=AIzaSyD2QzIlcQThNy5n1Kala8YK9ezUk19W7ro&callback=initMap&libraries=places" async defer></script>

    <script>
      function initMap() {
        'use strict';

        var target = document.getElementById('target');
        // var geocoder = new google.maps.Geocoder();
        var map;
        // var tokyo = { lat: 35.681167, lng: 139.767052 };
        // var service;

        // Geolocation
        if(!navagator.geolocation){
          alert('Geolocation not supported');
          return;
        }

        navigator.geolocation.getCurrentPosition(function(position){
          new google.maps.Map(target, {
            center: {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          },
          zoom: 15
        });
      }, function(){
        alert('Failed');
        return;
      })


        // Places API

        // map = new google.maps.Map(target, {
        //   center: tokyo,
        //   zoom: 15
        // })
        //
        // document.getElementById('search').addEventListener('click', function(){
        //   service = new google.maps.places.PlacesService(map);
        //   service.nearbySearch({
        //     location: tokyo,
        //     radius: '500',
        //     name: document.getElementById('keyword').value
        //   }, function(results, status) {
        //     if(status === google.maps.places.PlacesServiceStatus.OK) {
        //       for(var i = 0; i < results.length; i++){
        //         new google.maps.Marker({
        //           map: map,
        //           position: results[i].geometry.location,
        //           title: results[i].name
        //         });
        //       }
        //     }else {
        //       alert('failed');
        //       return;
        //     }
        //   });
        // });

        //Reverse Geocoding　緯度経度から住所を割り出す

        // map = new google.maps.Map(target, {
        //   center: {
        //     lat : 35.681167,
        //     lng: 139.767052,
        //   },
        //   zoom: 15
        // });
        //
        // map.addListener('click', function(e){
        //   geocoder.geocode({
        //     location: e.latLng
        //   }, function(results, status) {
        //     if(status !== 'OK') {
        //       alert('failed: ' + status);
        //       return;
        //     }
        //     if (results[0]){
        //         new google.maps.Marker({
        //           position: e.latLng,
        //           map: map,
        //           title: results[0].formatted_address,
        //         });
        //       } else {
        //         alert('no results');
        //         return;
        //
        //     }
        //   });
        // });


        // Geocoding 住所から緯度経度を割り出す

        // document.getElementById('search').addEventListener('click', function() {
        //   geocoder.geocode({
        //     address: document.getElementById('address').value
        //   }, function(results, status) {
        //     if(status !== 'OK') {
        //       alert('failed: ' + status);
        //       return;
        //     }
        //     if (results[0]) {
        //       new google.maps.Map(target, {
        //         center: results[0].geometry.location,
        //         zoom: 15
        //       });
        //     } else {
        //       alert('No results found');
        //       return;
        //     }
        //
        //   });
        // })



        // var map;

        // var infoWindow;
        //
        // map = new google.maps.Map(target, {
        //   center: tokyo,
        //   zoom : 15,
        // });
        //
        // map.addListener('click', function(e) {
        //   console.log(e.latLng.lat());
        //   console.log(e.latLng.lng());
        //   console.log(e.latLng.toString());
        //   // this.setCenter(e.latLng);
        //
        //    var marker = new google.maps.Marker({
        //     position: e.latLng,
        //     map: map,
        //     title: e.latLng.toString(),
        //   });
        //   marker.addListener('click', function(){
        //     this.setMap(null);
        //   });
        // });
        //
        // infoWindow = new google.maps.InfoWindow({
        //   position: tokyo,
        //   content: 'Hello!',
        // });
        // infoWindow.open(map);

      }
    </script>

  </body>
</html>
